---
title: "Latex公式识别OCR「mathpix的开源平替」"
date: 2023-04-23T14:41:01+08:00
slug: "0611e889"
hidden: false
tags: []
keywords: []
description: ""
Summary: ""
Navbar: false
comments: true
math: true
---



<!--more-->

## 前言

之前在网上找到一个公式OCR工具：`mathpix`非常好用，而且每个月100个免费识别的额度足够日常使用了。但最近写份作业，发现没识别几个公式额度就满了？查看账户发现`mathpix`免费额度变成了**10** Snips per month？

<img src="image-20230423144156742.png" alt="image-20230423144156742" style="zoom:25%;" />

并且其订阅费用每月4.99$不算便宜，然后就在GitHub上简单找了一下，看有没有开源的公式OCR软件。

<img src="image-20230423144311199.png" alt="image-20230423144311199" style="zoom: 25%;" />

<img src="image-20230423144747844.png" alt="image-20230423144747844" style="zoom: 33%;" />

果不其然，Latex-OCR[^1]，（pix2tex: Using a ViT to convert images of equations into LaTeX code）.十分好用，基本可以替代`mathpix`70%的功能。印刷版的公式识别基本没有错误，手写的识别准确率有待提高，最重要的，这个`pix2tex`是部署在本地的，随时可用，不用担心以后变成付费软件。

## pix2tex介绍

>[![GitHub](https://camo.githubusercontent.com/e26e90c96a0fee3de5b53a7232dfc0fd0f49f5ea6c9ec1449563dd40aefee496/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6c756b61732d626c65636865722f4c615465582d4f4352)](https://github.com/lukas-blecher/LaTeX-OCR) [![Documentation Status](https://camo.githubusercontent.com/a1e97c43de4d4103a26c25283713f88502716ee63268614479f996d7270d0f48/68747470733a2f2f72656164746865646f63732e6f72672f70726f6a656374732f706978327465782f62616467652f3f76657273696f6e3d6c6174657374)](https://pix2tex.readthedocs.io/en/latest/?badge=latest) [![PyPI](https://camo.githubusercontent.com/00f77be6f9cb1f78be8f53d85089b77df578e3e516777c949f781edd45a0e715/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f706978327465783f6c6f676f3d70797069)](https://pypi.org/project/pix2tex) [![PyPI - Downloads](https://camo.githubusercontent.com/8013cfd657c31171c1946c0b6b2b40a1c90d1f7c8d842dde209185d307e922b3/68747470733a2f2f696d672e736869656c64732e696f2f707970692f646d2f706978327465783f6c6f676f3d70797069)](https://pypi.org/project/pix2tex) [![GitHub all releases](https://camo.githubusercontent.com/a369d922b436161c9e517492585f9f424cba04cfd4d20b7815fed921d02cf3b1/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f646f776e6c6f6164732f6c756b61732d626c65636865722f4c615465582d4f43522f746f74616c3f636f6c6f723d626c7565266c6f676f3d676974687562)](https://github.com/lukas-blecher/LaTeX-OCR/releases) [![Docker Pulls](https://camo.githubusercontent.com/c1b9289285efdec353acaa08d4f0e55791c3c832f08106b99ce54850ed14df14/68747470733a2f2f696d672e736869656c64732e696f2f646f636b65722f70756c6c732f6c756b6173626c65636865722f706978327465783f6c6f676f3d646f636b6572)](https://hub.docker.com/r/lukasblecher/pix2tex) [![Open In Colab](https://camo.githubusercontent.com/84f0493939e0c4de4e6dbe113251b4bfb5353e57134ffd9fcab6b8714514d4d1/68747470733a2f2f636f6c61622e72657365617263682e676f6f676c652e636f6d2f6173736574732f636f6c61622d62616467652e737667)](https://colab.research.google.com/github/lukas-blecher/LaTeX-OCR/blob/main/notebooks/LaTeX_OCR_test.ipynb) [![Hugging Face Spaces](https://camo.githubusercontent.com/00380c35e60d6b04be65d3d94a58332be5cc93779f630bcdfc18ab9a3a7d3388/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f25463025394625413425393725323048756767696e67253230466163652d5370616365732d626c7565)](https://huggingface.co/spaces/lukbl/LaTeX-OCR)
>
>The goal of this project is to create a learning based system that takes an image of a math formula and returns corresponding LaTeX code.
>
>![109183599-69431f00-778e-11eb-9809-d42b9451e018](https://user-images.githubusercontent.com/55287601/109183599-69431f00-778e-11eb-9809-d42b9451e018.png)

## 安装

直接在终端输入：

```
pip install pix2tex
```

即可。

当然，前提是你需要一些基础环境：

- Python 3.7+
- PyTorch[^2] installed（Follow their instructions [here](https://pytorch.org/get-started/locally/).）

### 基础使用:

1. 打开一个终端；

2. 输入`pix2tex`，回车；

   <img src="image-20230423150000799.png" alt="image-20230423150000799" style="zoom:33%;" />

> 此时就可以开始使用了。

3. 截图并复制到剪切板

   <img src="image-20230423151259320.png" alt="image-20230423151259320" style="zoom:33%;" />

4. 在终端页面回车即可返回OCR识别的结果，是以Latex格式输出

   <img src="image-20230423151226904.png" alt="image-20230423151226904" style="zoom:33%;" />

5. 将以上输出结果复制到markdown、latex或者word[^3]都可直接识别出公式

   <img src="image-20230423151542885.png" alt="image-20230423151542885" style="zoom: 33%;" />

   公式：
   $$
   \sigma_{B}^{2}(k)=\frac{[m_{G}P_{1}(k)-m(k)]^{2}}{P_{1}(k)[1-P_{1}(k)]}
   $$
   



### 	其他使用方法

2. Thanks to [@katie-lim](https://github.com/katie-lim), you can use a nice user interface as a quick way to get the model prediction. Just call the GUI with `latexocr`. From here you can take a screenshot and the predicted latex code is rendered using [MathJax](https://www.mathjax.org/) and copied to your clipboard.

   Under linux, it is possible to use the GUI with `gnome-screenshot` which comes with multiple monitor support if `gnome-screenshot` was installed beforehand.

   <img src="https://user-images.githubusercontent.com/55287601/117812740-77b7b780-b262-11eb-81f6-fc19766ae2ae.gif" alt="117812740-77b7b780-b262-11eb-81f6-fc19766ae2ae" style="zoom:33%;" />

   If the model is unsure about the what's in the image it might output a different prediction every time you click "Retry". With the `temperature` parameter you can control this behavior (low temperature will produce the same result).

3. You can use an API. This has additional dependencies. Install via `pip install -U pix2tex[api]` and run

   ```
   python -m pix2tex.api.run
   ```

   to start a [Streamlit](https://streamlit.io/) demo that connects to the API at port 8502. There is also a docker image available for the API: https://hub.docker.com/r/lukasblecher/pix2tex [![Docker Image Size (latest by date)](https://camo.githubusercontent.com/5c27282a4120785ec54bf7b85a9e3dd4da3b73758535c8865a3ea4fd06cc4a4e/68747470733a2f2f696d672e736869656c64732e696f2f646f636b65722f696d6167652d73697a652f6c756b6173626c65636865722f706978327465783f6c6f676f3d646f636b6572)](https://hub.docker.com/r/lukasblecher/pix2tex)

   ```
   docker pull lukasblecher/pix2tex:api
   docker run --rm -p 8502:8502 lukasblecher/pix2tex:api
   ```

   To also run the streamlit demo run

   ```
   docker run --rm -it -p 8501:8501 --entrypoint python lukasblecher/pix2tex:api pix2tex/api/run.py
   ```

   and navigate to http://localhost:8501/

4. Use from within Python

   ```
   from PIL import Image
   from pix2tex.cli import LatexOCR
   
   img = Image.open('path/to/image.png')
   model = LatexOCR()
   print(model(img))
   ```

   The model works best with images of smaller resolution. That's why I added a preprocessing step where another neural network predicts the optimal resolution of the input image. This model will automatically resize the custom image to best resemble the training data and thus increase performance of images found in the wild. Still it's not perfect and might not be able to handle huge images optimally, so don't zoom in all the way before taking a picture.

   Always double check the result carefully. You can try to redo the prediction with an other resolution if the answer was wrong.

   **Want to use the package?**

   I'm trying to compile a documentation right now.

   Visit here: https://pix2tex.readthedocs.io/

## 	其他

### Training the model [![Open In Colab](https://camo.githubusercontent.com/84f0493939e0c4de4e6dbe113251b4bfb5353e57134ffd9fcab6b8714514d4d1/68747470733a2f2f636f6c61622e72657365617263682e676f6f676c652e636f6d2f6173736574732f636f6c61622d62616467652e737667)](https://colab.research.google.com/github/lukas-blecher/LaTeX-OCR/blob/main/notebooks/LaTeX_OCR_training.ipynb)

···

参考：[lukas-blecher/LaTeX-OCR: pix2tex: Using a ViT to convert images of equations into LaTeX code. (github.com)](https://github.com/lukas-blecher/LaTeX-OCR)

···

结束🔚。



[^1]:[lukas-blecher/LaTeX-OCR](https://github.com/lukas-blecher/LaTeX-OCR)
[^2]:[pytorch](https://pytorch.org/get-started/locally/)
[^3]:[在word中输入LaTeX公式](https://blog.csdn.net/m0_69599137/article/details/127456927)
